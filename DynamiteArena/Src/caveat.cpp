//*******************************************************************************************************************************************
//
// ダイナマイトアリーナ(caveat.cpp)
// Author : Kasai Keisuke
//
//*******************************************************************************************************************************************

// include 
#include "caveat.h"
#include "manager.h"
#include "explosion.h"

// 静的メンバ変数初期化
LPDIRECT3DTEXTURE9 CCaveat::m_pTextureTemp = nullptr;	// 警告表示テクスチャのポインタ

//*******************************************************************************************************************************************
// コンストラクタ
//*******************************************************************************************************************************************
CCaveat::CCaveat(int nPriority):CObject3D(nPriority),
m_bDeath(false),
m_nCnt(0)
{

}

//*******************************************************************************************************************************************
// デストラクタ
//*******************************************************************************************************************************************
CCaveat::~CCaveat()
{

}

//*******************************************************************************************************************************************
// 初期化処理
//*******************************************************************************************************************************************
HRESULT CCaveat::Init()
{
	// 3Dオブジェクトの初期化処理
	CObject3D::Init();

	return S_OK;
}

//*******************************************************************************************************************************************
// 終了処理
//*******************************************************************************************************************************************
void CCaveat::Uninit()
{
	// UIの破棄
	CObject3D::Release();

	// 3Dオブジェクトの終了処理
	CObject3D::Uninit();
}

//*******************************************************************************************************************************************
// 更新処理
//*******************************************************************************************************************************************
void CCaveat::Update()
{
	m_nCnt--;	// 表示カウントを減らす

	if (m_nCnt <= 0)
	{
		m_bDeath = true;
	}

	if (m_bDeath)
	{
		Death();

		CCaveat::Uninit();
	}
	else
	{
		// 3Dオブジェクトの更新処理
		CObject3D::Update();

	}


}

//*******************************************************************************************************************************************
// 描画処理
//*******************************************************************************************************************************************
void CCaveat::Draw()
{
	// 3Dオブジェクトの描画処理
	CObject3D::Draw();
}

//*******************************************************************************************************************************************
// 生成処理
//*******************************************************************************************************************************************
CCaveat* CCaveat::Create(D3DXVECTOR3 pos, float fWidth, float fHeight, float fDepth)
{
	CCaveat* pCaveat = new CCaveat();

	pCaveat->Init();	// 初期化処理

	pCaveat->SetObject3D(pos, fWidth, fHeight, fDepth);

	pCaveat->m_nCnt = DRAW_COUNT;	// 表示時間

	if (m_pTextureTemp != nullptr)
	{
		pCaveat->BindTexture(m_pTextureTemp);
	}

	return pCaveat;
}

//*******************************************************************************************************************************************
// テクスチャロード
//*******************************************************************************************************************************************
HRESULT CCaveat::Load()
{
	// シングルトンインスタンスの取得
	CManager& manager = CManager::GetInstance();

	if (m_pTextureTemp == nullptr)
	{
		// テクスチャの読み込み
		D3DXCreateTextureFromFile(manager.GetRenderer()->GetDevice(),
			"data\\TEXTURE\\caveatUI000.png",
			&m_pTextureTemp);

	}

	return S_OK;
}

//*******************************************************************************************************************************************
// テクスチャアンロード
//*******************************************************************************************************************************************
void CCaveat::UnLoad()
{
	if (m_pTextureTemp != nullptr)
	{
		m_pTextureTemp->Release();

		m_pTextureTemp = nullptr;
	}

}

//*******************************************************************************************************************************************
// 死亡判定
//*******************************************************************************************************************************************
void CCaveat::Death()
{
	D3DXVECTOR3 CurrentPos = GetPos();

	CExplosion::Create(D3DXVECTOR3(CurrentPos.x,10.0f,CurrentPos.z));

}
