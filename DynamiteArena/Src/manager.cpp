//*******************************************************************************************************************************************
//
// ダイナマイトアリーナ(manager.cpp)
// Author : Kasai Keisuke
//
//*******************************************************************************************************************************************

// include

//******************************************
// System
//******************************************
#include "manager.h"

//***********************************************************************************************************************
// コンストラクタ
//***********************************************************************************************************************
CManager::CManager()
{
	m_pRenderer = nullptr;		// レンダラーのポインタ
	m_InputKeyboard = nullptr;	// キーボードのポインタ
	m_InputJoypad = nullptr;	// ジョイパッドのポインタ
	m_pCamera = nullptr;		// カメラのポインタ
	m_pLight = nullptr;			// ライトのポインタ
	m_pScene = nullptr;			// シーンのポインタ
	m_pParamManager = nullptr;
	m_pGameManager = nullptr;

	m_bGoal = false;			// ゴール判定用フラグ
}

//***********************************************************************************************************************
// デストラクタ
//***********************************************************************************************************************
CManager::~CManager()
{
	m_pRenderer = nullptr;		// レンダラーのポインタ
	m_InputKeyboard = nullptr;	// キーボードのポインタ
	m_InputJoypad = nullptr;	// ジョイパッドのポインタ
	m_pCamera = nullptr;		// カメラのポインタ
	m_pParamManager = nullptr;	// パラメーター管理クラスのポインタ
	m_pGameManager = nullptr;

	m_bGoal = false;			// ゴール判定用フラグ
}

//***********************************************************************************************************************
// 初期化処理
//***********************************************************************************************************************
HRESULT CManager::Init(HINSTANCE hInstance, HWND hWnd, BOOL bWindow)
{
	//***********************************
	// レンダラー
	//***********************************
	m_pRenderer = new CRenderer();		

	m_pRenderer->Init(hWnd, bWindow);	

	//***********************************
	// キーボード
	//***********************************
	m_InputKeyboard = new CInputKeyboard();

	m_InputKeyboard->Init(hInstance,hWnd);

	//***********************************
	// ジョイパッド
	//***********************************
	m_InputJoypad = new CInputJoypad();

	m_InputJoypad->Init(hInstance, hWnd);

	//***********************************
	// カメラ
	//***********************************
	m_pCamera = new CCamera();

	m_pCamera->Init();

	//***********************************
	// ライト
	//***********************************
	m_pLight = new CLight();

	m_pLight->Init();

	//***********************************
	// パラメーター管理クラス
	//***********************************
	m_pParamManager = new CParamManager();

	//***********************************
	// ゲームマネージャークラス
	//***********************************
	m_pGameManager = new CGameManager();

	// 最初のシーンの設定
	SetMode(CScene::MODE::MODE_TITLE);

	return S_OK;
}

//***********************************************************************************************************************
// 終了処理
//***********************************************************************************************************************
void CManager::Uninit()
{
	//***********************************
	// キーボード
	//***********************************
	if (m_InputKeyboard != nullptr)
	{
		m_InputKeyboard->Uninit();

		delete m_InputKeyboard;

		m_InputKeyboard = nullptr;
	}

	//***********************************
	// ジョイパッド
	//***********************************
	if (m_InputJoypad != nullptr)
	{
		m_InputJoypad->Uninit();

		delete m_InputJoypad;

		m_InputJoypad = nullptr;
	}

	//***********************************
	// シーン
	//***********************************
	if (m_pScene != nullptr)
	{
		m_pScene->Uninit();

		delete m_pScene;

		m_pScene = nullptr;
	}

	//***********************************
	// カメラ
	//***********************************
	if (m_pCamera != nullptr)
	{
		m_pCamera->Uninit();

		delete m_pCamera;

		m_pCamera = nullptr;
	}

	//***********************************
	// ライト
	//***********************************
	if (m_pLight != nullptr)
	{
		m_pLight->Uninit();

		delete m_pLight;

		m_pLight = nullptr;
	}

	//***********************************
	// レンダラー
	//***********************************
	if (m_pRenderer != nullptr)
	{
		m_pRenderer->Uninit();

		delete m_pRenderer;

		m_pRenderer = nullptr;
	}
}

//***********************************************************************************************************************
// 更新処理
//***********************************************************************************************************************
void CManager::Update()
{
	//***********************************
	// キーボード
	//***********************************
	if (m_InputKeyboard != nullptr)
	{
		m_InputKeyboard->Update();
	}

	//***********************************
	// ジョイパッド
	//***********************************
	if (m_InputJoypad != nullptr)
	{
		m_InputJoypad->Update();
	}

	//***********************************
	// レンダラー
	//***********************************
	if (m_pRenderer != nullptr)
	{
		m_pRenderer->Update();
	}

	//***********************************
	// カメラ
	//***********************************
	if (m_pCamera != nullptr)
	{
		m_pCamera->Update();
	}

	//***********************************
	// ライト
	//***********************************
	if (m_pLight != nullptr)
	{
		m_pLight->Update();
	}

	//***********************************
	// シーン
	//***********************************
	if (m_pScene != nullptr)
	{
		m_pScene->Update();
	}
}

//***********************************************************************************************************************
// 描画処理
//***********************************************************************************************************************
void CManager::Draw()
{
	if (m_pScene != nullptr)
	{// シーンの描画処理
		m_pScene->Draw();
	}

	if (m_pRenderer != nullptr)
	{
		// レンダラーの描画処理
		m_pRenderer->Draw();
	}
}

//***********************************************************************************************************************
// レンダラー取得処理
//***********************************************************************************************************************
CRenderer* CManager::GetRenderer()
{
	return m_pRenderer;
}

//***********************************************************************************************************************
// キーボード取得処理
//***********************************************************************************************************************
CInputKeyboard* CManager::GetKeyboard()
{
	return m_InputKeyboard;
}

//***********************************************************************************************************************
// ジョイパッド取得処理
//***********************************************************************************************************************
CInputJoypad* CManager::GetJoypad()
{
	return m_InputJoypad;
}

//***********************************************************************************************************************
// カメラ情報取得処理
//***********************************************************************************************************************
CCamera* CManager::GetCamera()
{
	return m_pCamera;
}

//***********************************************************************************************************************
// ライト情報取得処理
//***********************************************************************************************************************
CLight* CManager::GetLight()
{
	return m_pLight;
}

//***********************************************************************************************************************
// モード設定処理
//***********************************************************************************************************************
CParamManager* CManager::GetParamManager()
{
	return m_pParamManager;
}

//***********************************************************************************************************************
// モード設定処理
//***********************************************************************************************************************
CGameManager* CManager::GetGameManager()
{
	return m_pGameManager;
}

//***********************************************************************************************************************
// モード設定処理
//***********************************************************************************************************************
void CManager::SetMode(CScene::MODE mode)
{
	// 終了処理
	if (m_pScene != nullptr)
	{
		m_pScene->Uninit();

		delete m_pScene;

		m_pScene = nullptr;
	}

	m_pScene = CScene::Create(mode);
}

//***********************************************************************************************************************
// ゴール判定用フラグ設定処理
//***********************************************************************************************************************
void CManager::SetGoal(bool bGoal)
{
	m_bGoal = bGoal;
}

//***********************************************************************************************************************
// ゴール判定用フラグ取得処理
//***********************************************************************************************************************
bool CManager::GetGoal()
{
	return m_bGoal;
}
